<!-- contract-form.html -->
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>แบบฟอร์มสัญญา - Praweena Property</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- App CSS -->
  <link rel="stylesheet" href="/assets/css/base.css"/>
  <link rel="stylesheet" href="/assets/css/layout.css"/>
  <link rel="stylesheet" href="/assets/css/components.css"/>
  <link rel="stylesheet" href="/assets/css/style.css"/>

  <style>
    /* --- Contract page specific --- */
    .page-header{ margin-bottom:1.25rem; }
    .page-header h1{ font-size:1.6rem; margin-bottom:.25rem; }
    .text-muted{ color:var(--text-light); }

    .form-grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:1rem;
    }
    .form-grid .col-span-2{ grid-column: span 2; }
    @media (max-width:768px){
      .form-grid{ grid-template-columns: 1fr; }
      .form-grid .col-span-2{ grid-column: span 1; }
    }

    /* --- Autocomplete dropdown --- */
    .ac-wrap{ position:relative; }
    .ac-list{
      position:absolute; left:0; right:0; top:100%;
      background:#fff; border:1px solid var(--border-color);
      border-radius:12px; box-shadow: var(--shadow-md);
      max-height:260px; overflow:auto; z-index:50;
      display:none; margin-top:.35rem;
    }
    .ac-list.open{ display:block; }
    .ac-item{
      padding:.6rem .75rem; cursor:pointer; font-size:.95rem;
    }
    .ac-item + .ac-item{ border-top:1px solid var(--border-color); }
    .ac-item:hover{ background:#fafafa; }
    .ac-item small{ color:var(--text-light); font-size:.8rem; }

    /* --- Preview overlay (Export PDF) --- */
    #contract-preview-modal.modal{
      position: fixed; inset:0; display:none;
      background: rgba(0,0,0,.55); z-index: 1000;
      align-items:center; justify-content:center;
      padding: 3vh 3vw;
    }
    #contract-preview-modal.open{ display:flex; }
    #contract-preview-modal .modal-content{
      width:min(980px, 96vw);
      max-height:94vh; overflow:auto;
      background:#fff; border-radius:16px;
      box-shadow: var(--shadow-md); position:relative;
      padding: 1.25rem 1.5rem;
    }
    #contract-preview-modal .modal-close{
      position:absolute; right:12px; top:10px;
      font-size:1.6rem; cursor:pointer; color:#555;
      background:#fff; border-radius:999px; width:36px; height:36px;
      display:flex; align-items:center; justify-content:center;
      box-shadow: var(--shadow-sm);
    }
    #contract-preview{
      font-size: .95rem; color:#111; line-height:1.7;
    }
    #contract-preview h2{ margin:.25rem 0 .75rem; }
    #contract-preview .pv-grid{
      display:grid; grid-template-columns: 1fr 1fr; gap:.75rem 1rem;
    }
    #contract-preview .pv-grid .pv-row{ border-bottom:1px dashed #eee; padding-bottom:.35rem; }
    #contract-preview .pv-label{ color:#666; font-size:.85rem; }
    #contract-preview .pv-value{ font-weight:600; }
    @media print{
      body{ background:#fff; }
      #contract-preview-modal{ position:static; inset:auto; background:none; padding:0; }
      #contract-preview-modal .modal-content{ box-shadow:none; max-height:none; }
      #contract-preview-modal .modal-close,
      #preview-actions{ display:none !important; }
    }
  </style>
</head>

<body>
  <!-- Header (เหมือนทุกหน้า) -->
  <header class="header">
    <div class="container">
      <nav class="nav">
        <a href="/index.html" class="logo">
          <img src="/assets/img/logo.png" alt="Praweena Property Logo" class="logo-img">
          <span class="logo-text">Praweena Property</span>
        </a>
        <ul class="nav-links">
          <li><a href="/index.html">หน้าแรก</a></li>
          <li><a href="/dashboard.html">แดชบอร์ด</a></li>
          <li><a href="/leads.html">ผู้สนใจ</a></li>
          <li><a href="/renovation-book-list.html">สมุดรีโนเวท</a></li>
          <li><a href="/contracts-list.html">สัญญา</a></li>
          <li><a href="#" id="sign-out-btn" style="display:none;">ออกจากระบบ</a></li>
        </ul>
        <button id="mobile-nav-toggle" class="mobile-nav-toggle">☰</button>
      </nav>
    </div>
  </header>

  <main class="page page-contract">
    <div class="container">

      <header class="page-header">
        <h1>แบบฟอร์มสัญญา</h1>
        <p class="text-muted">ค้นหาลูกค้า เลือกบ้าน บันทึกสัญญา และ Export PDF ได้ในหน้าเดียว</p>
        <p id="contract-lead-info" class="text-muted" style="margin-top:.35rem;font-size:.9rem;">
          พร้อมใช้งาน
        </p>
      </header>

      <!-- 1) ลูกค้า -->
      <section class="card" style="margin-bottom:1rem;">
        <div class="card-header"><h2>1) ข้อมูลลูกค้า</h2></div>
        <div class="card-body form-grid">

          <div class="form-group col-span-2 ac-wrap">
            <label>ค้นหาลูกค้า (ชื่อ/เบอร์/อีเมล)</label>
            <input id="lead-search" type="text" class="form-control" placeholder="พิมพ์เพื่อค้นหา...">
            <div id="lead-ac" class="ac-list"></div>
          </div>

          <input type="hidden" id="lead_id">

          <div class="form-group">
            <label>ชื่อลูกค้า</label>
            <input id="lead_name" type="text" class="form-control" placeholder="ชื่อ-นามสกุล">
          </div>

          <div class="form-group">
            <label>เบอร์โทร</label>
            <input id="lead_phone" type="text" class="form-control" placeholder="0xx-xxx-xxxx">
          </div>

          <div class="form-group">
            <label>อีเมล</label>
            <input id="lead_email" type="email" class="form-control" placeholder="example@email.com">
          </div>

          <div class="form-group">
            <label>เลขบัตรประชาชน</label>
            <input id="lead_idcard" type="text" class="form-control" placeholder="x-xxxx-xxxxx-xx-x">
          </div>

          <div class="form-group col-span-2">
            <label>ที่อยู่</label>
            <textarea id="lead_address" class="form-control" rows="2" placeholder="ที่อยู่ตามบัตร/ที่อยู่จัดส่งเอกสาร"></textarea>
          </div>

        </div>
      </section>

      <!-- 2) บ้าน -->
      <section class="card" style="margin-bottom:1rem;">
        <div class="card-header"><h2>2) ข้อมูลบ้าน</h2></div>
        <div class="card-body form-grid">

          <div class="form-group col-span-2">
            <label>เลือกบ้าน (จาก Properties)</label>
            <select id="property_id" class="form-control">
              <option value="">-- เลือกบ้าน --</option>
            </select>
          </div>

          <div class="form-group">
            <label>ชื่อบ้าน/โครงการ</label>
            <input id="property_name" type="text" class="form-control" placeholder="เช่น บ้านวังเพชร">
          </div>

          <div class="form-group">
            <label>ราคาขาย (บาท)</label>
            <input id="property_price" type="number" class="form-control" placeholder="0">
          </div>

          <div class="form-group col-span-2">
            <label>ที่อยู่บ้าน</label>
            <textarea id="property_address" class="form-control" rows="2"></textarea>
          </div>

        </div>
      </section>

      <!-- 3) รายละเอียดสัญญา -->
      <section class="card" style="margin-bottom:1rem;">
        <div class="card-header"><h2>3) รายละเอียดสัญญา</h2></div>
        <div class="card-body form-grid">

          <input type="hidden" id="contract_id">

          <div class="form-group">
            <label>วันที่ทำสัญญา</label>
            <input id="contract_date" type="date" class="form-control">
          </div>

          <div class="form-group">
            <label>ประเภทสัญญา</label>
            <select id="contract_type" class="form-control">
              <option value="reservation">สัญญาจอง</option>
              <option value="sale">สัญญาซื้อขาย</option>
              <option value="lease">สัญญาเช่า</option>
            </select>
          </div>

          <div class="form-group">
            <label>เงินจอง/มัดจำ (บาท)</label>
            <input id="deposit_amount" type="number" class="form-control" placeholder="0">
          </div>

          <div class="form-group">
            <label>ยอดชำระแล้ว (บาท)</label>
            <input id="paid_amount" type="number" class="form-control" placeholder="0">
          </div>

          <div class="form-group">
            <label>ยอดคงเหลือ (บาท)</label>
            <input id="remain_amount" type="number" class="form-control" placeholder="0" readonly>
          </div>

          <div class="form-group">
            <label>กำหนดโอน/นัดเซ็นสัญญาใหญ่</label>
            <input id="transfer_date" type="date" class="form-control">
          </div>

          <div class="form-group col-span-2">
            <label>เงื่อนไขเพิ่มเติม</label>
            <textarea id="contract_note" class="form-control" rows="3"
              placeholder="เช่น ลูกค้าขอกู้ธนาคาร..., นัดตรวจบ้านก่อนโอน..., ฯลฯ"></textarea>
          </div>

        </div>
      </section>

      <!-- Actions -->
      <div style="display:flex;gap:.75rem;flex-wrap:wrap;margin:1rem 0 2rem;">
        <button id="save-contract-btn" class="btn">บันทึกสัญญา</button>
        <button id="preview-contract-btn" class="btn btn-secondary">พรีวิว / Export PDF</button>
        <a href="/contracts-list.html" class="btn btn-secondary">กลับหน้ารายการสัญญา</a>
      </div>

    </div>
  </main>

  <!-- Preview Modal -->
  <div id="contract-preview-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="preview-close">✕</button>

      <div id="preview-actions" style="display:flex;gap:.5rem;justify-content:flex-end;margin-bottom:.75rem;">
        <button id="print-btn" class="btn">พิมพ์ / Save PDF</button>
      </div>

      <div id="contract-preview"></div>
    </div>
  </div>

  <!-- Page JS -->
  <script type="module" src="/js/pages/contract-form.page.js"></script>
</body>
</html>
